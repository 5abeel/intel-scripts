#!/bin/bash

# This script runs all the steps in sequence
# Review config.env before running for environment details

# Source the environment file
source ./config.env

# Helper function to run scripts with error handling
run_script() {
    local script="$1"
    local description="$2"
    
    echo "Running $description..."
    if ! ./"$script"; then
        echo "ERROR: $script failed. Stopping full-bringup."
        exit 1
    fi
    echo "âœ“ $description completed"
}

# 1. Reboot IMC/ACC + setup P4 pkg from target_copy folder
run_script "1-setup-imc-acc.sh" "IMC/ACC setup"

# 2. Init ACC, setup comms channel, start IDPF driver on host
if [ "$PKG_NAME" = "fxp-net_linux-networking" ]; then
    run_script "2-init-acc-lnw.sh" "ACC initialization (LNW)"
else
    run_script "2-init-acc.sh" "ACC initialization"
fi

# 3. Program P4 tables, run OVS and setup LNW
if [ "$PKG_NAME" = "fxp-net_linux-networking" ]; then
    run_script "3-auto.sh" "P4 tables and OVS setup"
    #./3-auto-vxlan-ipsec-tunnel.sh
    #./3-auto-dual-port-ipsec-tunnel.sh
fi
